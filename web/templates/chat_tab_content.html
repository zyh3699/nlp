        <!-- Chat Tab -->
        <div class="tab-pane fade" id="chat">
            <!-- Configuration Wizard -->
            <div id="chatConfigWizard">
                <div class="card border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-gear"></i> 配置 Claude 连接
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">首次使用需要配置连接方式，之后可以直接对话</p>
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold">选择连接方式：</label>
                            <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="chatMethod" id="methodMcp" value="mcp" checked>
                                <label class="btn btn-outline-primary" for="methodMcp">
                                    <i class="bi bi-star-fill"></i> Claude Desktop/Code (推荐)
                                </label>
                                
                                <input type="radio" class="btn-check" name="chatMethod" id="methodApi" value="api">
                                <label class="btn btn-outline-secondary" for="methodApi">
                                    <i class="bi bi-key"></i> API 直接调用
                                </label>
                            </div>
                        </div>
                        
                        <!-- MCP Configuration -->
                        <div id="mcpConfig" class="config-section">
                            <div class="alert alert-success">
                                <strong>✅ 推荐使用 Claude Desktop/Code</strong>
                                <ul class="mb-0 mt-2 small">
                                    <li>无需额外 API 费用 (使用订阅版)</li>
                                    <li>完整的对话体验和上下文</li>
                                    <li>自动工具调用</li>
                                </ul>
                            </div>
                            
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-1-circle-fill text-primary"></i> 安装 MCP 服务器</h6>
                                    <div class="input-group mb-2">
                                        <input type="text" class="form-control font-monospace small" 
                                               id="mcpInstallCmdInput" readonly>
                                        <button class="btn btn-outline-secondary" onclick="copyMcpInstallCmd()">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                    <small class="text-muted">复制命令并在终端执行</small>
                                </div>
                            </div>
                            
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <h6><i class="bi bi-2-circle-fill text-primary"></i> 启动 Claude</h6>
                                    <code class="d-block bg-dark text-light p-2 rounded">claude</code>
                                    <small class="text-muted d-block mt-2">在终端运行此命令</small>
                                </div>
                            </div>
                            
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="mcpInstalledCheck">
                                <label class="form-check-label" for="mcpInstalledCheck">
                                    我已完成 MCP 配置并在另一个窗口启动了 Claude
                                </label>
                            </div>
                            
                            <button class="btn btn-primary" onclick="completeMcpConfig()" disabled id="mcpCompleteBtn">
                                <i class="bi bi-check-circle"></i> 完成配置，开始对话
                            </button>
                        </div>
                        
                        <!-- API Configuration -->
                        <div id="apiConfig" class="config-section" style="display: none;">
                            <div class="alert alert-warning">
                                <strong>⚠️ 使用 API 直接调用</strong>
                                <ul class="mb-0 mt-2 small">
                                    <li>需要 Anthropic API 密钥</li>
                                    <li>会产生 API 调用费用</li>
                                    <li>在浏览器中直接对话</li>
                                </ul>
                            </div>
                            
                            <div class="mb-3">
                                <label for="chatApiKey" class="form-label">
                                    <i class="bi bi-key"></i> Anthropic API Key
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-shield-lock"></i></span>
                                    <input type="password" class="form-control" id="chatApiKey" 
                                           placeholder="sk-ant-api03-...">
                                    <button class="btn btn-outline-secondary" type="button" 
                                            onclick="toggleChatApiKeyVisibility()">
                                        <i class="bi bi-eye" id="chatApiKeyToggleIcon"></i>
                                    </button>
                                </div>
                                <small class="text-muted">从 console.anthropic.com 获取</small>
                            </div>
                            
                            <button class="btn btn-primary" onclick="completeApiConfig()">
                                <i class="bi bi-check-circle"></i> 保存配置，开始对话
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div id="chatInterface" style="display: none;">
                <div class="card">
                    <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="mb-0">
                                    <i class="bi bi-robot"></i> Claude Assistant
                                </h5>
                                <small id="chatMethodIndicator">连接方式：加载中...</small>
                            </div>
                            <button class="btn btn-sm btn-light" onclick="reconfigureChat()">
                                <i class="bi bi-gear"></i> 重新配置
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="height: 500px; display: flex; flex-direction: column;">
                        <!-- Messages Container -->
                        <div id="chatMessages" class="flex-grow-1 overflow-auto mb-3 p-3 bg-light rounded">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-chat-dots display-1"></i>
                                <p class="mt-3">开始对话...</p>
                            </div>
                        </div>
                        
                        <!-- Input Area -->
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatInput" 
                                   placeholder="输入消息..." 
                                   onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendChatMessage(); }">
                            <button class="btn btn-primary" onclick="sendChatMessage()" id="sendChatBtn">
                                <i class="bi bi-send"></i> 发送
                            </button>
                        </div>
                        
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-lightbulb"></i> 
                                <span id="chatTip">可以要求 Claude 使用生成的 MCP 工具</span>
                            </small>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Examples -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6 class="mb-0"><i class="bi bi-lightning"></i> 快速示例</h6>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2" id="quickExamples">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
